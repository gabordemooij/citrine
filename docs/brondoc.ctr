Programma geheugen: 200.000.000.

â˜ tÄ³d         := Moment nieuw tÄ³d ruw.
â˜ datum       := Moment nieuw formaat: '%Y-%m-%d'.
â˜ ontwerp     := Bestand nieuw: 'template.html', lezen.
â˜ handleiding := LÄ³st nieuw.
â˜ broncode    := ''.

broncode toevoegen: (Bestand nieuw: '../base.c',        lezen).
broncode toevoegen: (Bestand nieuw: '../collections.c', lezen).
broncode toevoegen: (Bestand nieuw: '../file.c',        lezen).
broncode toevoegen: (Bestand nieuw: '../system.c',      lezen).

â˜ talen   := Reeks nieuw.
â˜ blokken := broncode opsplitsen: '@def'.
blokken afschuiven.
â˜ totaal  := blokken aantal.


Tekst bÄ³: 'html' doen: {
	
	â˜ html := â› tekst kopieer.
	html vervang: '"' door: '&quot;'.
	html vervang: '<' door: '&lt;'.
	html vervang: '>' door: '&gt;'.
	html vervang: '&' door: '&amp;'.
	html vervang: 'â†µ' door: '<br>'.
	â†² html.
}.

Bestand reeks: '../i18n', elk: { :nummer :taalinformatie
	â˜ taal := taalinformatie bestand.
	taal = '..' of: taal = '.', doorgaan.
	handleiding zet: (Reeks nieuw) bÄ³: taal.
	talen toevoegen: taal.
}.

talen sorteren: { :a :b â†² a > b. }.

blokken elk: { :nummer :blok

	âœ schrÄ³f: (
		'Bezig met blok: ğŸ ¶bloknummer van: ğŸ ¶totaal.â†µ'
		ğŸ ¶bloknummer: nummer,
		ğŸ ¶totaal: totaal
	).

	blok
	vervang: ' * ' door: '',
	vervang: ' *â†µ' door: ''.

	â˜ blokinhoud    := blok opsplitsen: '*/', eerste.
	
	â˜ blokdelen     := blokinhoud opsplitsen: '@example'.
	â˜ definitie     := blokdelen eerste verwÄ³derâ€‰omliggendeâ€‰spaties.
	â˜ voorbeeld     := blokdelen laatste verwÄ³derâ€‰omliggendeâ€‰spaties.
	â˜ resultaat     := ''.
	â˜ resultaat?    := voorbeeld bevat: '@result'.

	resultaat? ja: {
		voorbeeld := voorbeeld opsplitsen: '@result'.
		resultaat := voorbeeld eraf.
	}.

	â˜ definitiebestand := Bestand nieuw: '/tmp/def.ctr'.
	â˜ codebestand      := Bestand nieuw: '/tmp/code.ctr'.

	definitiebestand schrÄ³f: definitie.
	codebestand schrÄ³f: voorbeeld.

	talen elk: { :nummer :taalinformatie
	
		â˜ taal := taalinformatie bestand.

		â˜ commando := 
		'../bin/Linux/ctrus -t ../dict/enğŸ ¶taal.dict /tmp/def.ctr 2>/dev/null'.
		commando ğŸ ¶taal: taal.

		â˜ vertaaldeâ€‰definitie := Programma opdrachtregel: commando.
		commando := 
		'../bin/Linux/ctrus -t ../dict/enğŸ ¶taal.dict /tmp/code.ctr 1>/tmp/run.ctr 2>/dev/null'.
		commando ğŸ ¶taal: taal.

		Programma opdrachtregel: commando.
		â˜ vertaaldeâ€‰code := Bestand nieuw: '/tmp/run.ctr', lezen.

		resultaat? nee: {
			commando := '../bin/Linux/ctrğŸ ¶taal /tmp/run.ctr 2>/tmp/err.log'.
			commando ğŸ ¶taal: taal.
			resultaat := Programma opdrachtregel: commando.
		}.

		commando := 'echo "ğŸ ¶code" | sha1sum'.
		commando ğŸ ¶code: ( taal + vertaaldeâ€‰definitie ).
		â˜ link := Programma opdrachtregel: commando, opsplitsen: ' ', eerste.

		â˜ hoofdstuk := Reeks nieuw
		â€¢ vertaaldeâ€‰definitie
		â€¢ vertaaldeâ€‰code
		â€¢ resultaat
		â€¢ link.
		â˜ x := handleiding bÄ³: taal, toevoegen: hoofdstuk.
	}.
}.

â˜ taalregister := ''.
talen elk: { :nummer :taal

	â˜ eersteâ€‰hoofdstuk := handleiding bÄ³: taal, eerste.
	â˜ link := eersteâ€‰hoofdstuk laatste.
	â˜ regel := '<li><a href="/docs/ğŸ ¶taal/ğŸ ¶link.ctr" >ğŸ ¶taal</a></li>'.

	regel
	ğŸ ¶taal: taal,
	ğŸ ¶link: link.

	taalregister toevoegen: regel.
	â˜ commando := 
	'mkdir server/docs/ğŸ ¶taal'.
	commando ğŸ ¶taal: taal.

	Programma opdrachtregel: commando.
}.

handleiding elk: { :taal :hoofdstukken

	â˜ inhoudsopgave := ''.
	hoofdstukken elk: { :nummer :onderdelen

		â˜ link := onderdelen laatste.
		â˜ titel := onderdelen eerste.
		â˜ regel := '<li><a href="/docs/ğŸ ¶taal/ğŸ ¶link.ctr" >ğŸ ¶titel</a></li>'.
		regel
			ğŸ ¶taal: taal,
			ğŸ ¶link: link,
			ğŸ ¶titel: titel.
		inhoudsopgave toevoegen: regel.
	}.

	hoofdstukken elk: { :nummer :onderdelen

		â˜ document := ontwerp kopieer.
		document
			ğŸ ¶datum: datum,
			ğŸ ¶tÄ³d: tÄ³d,
			ğŸ ¶taalregister: taalregister,
			ğŸ ¶taal: taal,
			ğŸ ¶titeltaal: taal hoofdletters,
			ğŸ ¶hoofdstuk: onderdelen eerste html,
			ğŸ ¶voorbeeld: (onderdelen positie: 2) html,
			ğŸ ¶resultaat: (onderdelen positie: 3) html,
			ğŸ ¶inhoudsopgave: inhoudsopgave.

		â˜ bestandslocatie := 'server/docs/ğŸ ¶taal/ğŸ ¶link.ctr'.
		bestandslocatie
			ğŸ ¶taal: taal,
			ğŸ ¶link: onderdelen laatste.

		Bestand nieuw: bestandslocatie, schrÄ³f: document.
		âœ schrÄ³f: bestandslocatie, stop.
	}.
}.
